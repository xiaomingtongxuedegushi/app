(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56d90ef9"],{"7e33":function(t,e,a){"use strict";a("9133")},9133:function(t,e,a){},a803:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"mc-container-full",staticStyle:{padding:"0","box-sizing":"border-box","margin-top":"-150px"}},[a("div",{staticStyle:{position:"fixed",right:"32px",top:"32px","z-index":"1000","background-color":"#ffffff","box-shadow":"0 0 12px 2px rgba(0,0,0,0.5)"}},[a("el-button",{on:{click:t.uploadImage}},[t._v("上传背景图片")]),a("el-button",{on:{click:t.downloadPoint}},[t._v("下载点位数据")]),a("el-button",{on:{click:t.resetArea}},[t._v("回到画布原点")])],1),a("div",{staticClass:"point-container",on:{mousedown:function(e){return t.mouseDown("mouse",e)},mouseup:function(e){return t.mouseUp("mouse",e)},mousemove:function(e){return t.moseMove("mouse",e)},touchstart:function(e){return e.stopPropagation(),e.preventDefault(),t.mouseDown("touch",e)},touchmove:function(e){return e.stopPropagation(),e.preventDefault(),t.moseMove("touch",e)},touchend:function(e){return e.stopPropagation(),e.preventDefault(),t.mouseUp("touch",e)}}},[a("div",{ref:"pointViewArea",staticClass:"point-view-area",style:{marginTop:t.viewArea.top+"px",marginLeft:t.viewArea.left+"px",transform:"scale("+t.viewArea.zoom+")"}},[a("div",{staticClass:"point-view-image",staticStyle:{"user-select":"none"},on:{dblclick:function(e){return t.imageAreaClick(e)}}},[a("div",{staticClass:"points"},t._l(t.points,(function(e){return a("div",{key:"point-"+e.id,ref:"point-ref-"+e.id,refInFor:!0,class:{fade:t.pointFade,pointV:"v"===e.data.pointType,pointChart:"chart"===e.data.pointType,point:"status"===e.data.pointType,primary:"status"===e.data.pointType&&0===e.data.pointStatus,danger:"status"===e.data.pointType&&1===e.data.pointStatus,warning:"status"===e.data.pointType&&2===e.data.pointStatus},style:{top:e.y+"px",left:e.x+"px"},attrs:{id:"point-"+e.id,title:"名称: "+e.data.name+"\r\n板卡号: "+e.data.cardNo+"\r\n故障地址: "+e.data.faultNo,"data-point":e.id},on:{click:function(a){return t.pointClick(e)}}},["status"===e.data.pointType?a("div",{staticClass:"point-status"},[0===e.data.pointStatus?a("span",{staticClass:"point-status-text"},[t._v("正常")]):t._e(),1===e.data.pointStatus?a("span",{staticClass:"point-status-text"},[t._v("故障")]):t._e(),2===e.data.pointStatus?a("span",{staticClass:"point-status-text"},[t._v("虚接")]):t._e()]):t._e()])})),0),a("img",{ref:"mainImage",attrs:{ondragstart:"return false",draggable:"false",src:t.backgroundImage,alt:""}})])])])]),"admin"===t.pointMode?a("el-dialog",{attrs:{visible:t.pointDialog.open,"close-on-click-modal":!1,title:"设置故障点"},on:{"update:visible":function(e){return t.$set(t.pointDialog,"open",e)}}},[a("div",{staticClass:"r-table middle",staticStyle:{"max-width":"480px"}},[a("div",{staticClass:"r-table-item"},[a("div",{staticClass:"name"},[t._v(" 点ID ")]),a("div",{staticClass:"value"},[a("el-input",{attrs:{readonly:"",size:"small",type:"text"},model:{value:t.pointDialog.pointId,callback:function(e){t.$set(t.pointDialog,"pointId",e)},expression:"pointDialog.pointId"}})],1)]),a("div",{staticClass:"r-table-item"},[a("div",{staticClass:"name"},[t._v(" 名称 ")]),a("div",{staticClass:"value"},[a("el-input",{attrs:{size:"small",type:"text"},model:{value:t.pointDialog.name,callback:function(e){t.$set(t.pointDialog,"name",e)},expression:"pointDialog.name"}})],1)]),a("div",{staticClass:"r-table-item"},[a("div",{staticClass:"name"},[t._v(" 板卡号 ")]),a("div",{staticClass:"value"},[a("el-input",{attrs:{size:"small",type:"text"},model:{value:t.pointDialog.cardNo,callback:function(e){t.$set(t.pointDialog,"cardNo",e)},expression:"pointDialog.cardNo"}})],1)]),a("div",{staticClass:"r-table-item"},[a("div",{staticClass:"name"},[t._v(" 故障地址 ")]),a("div",{staticClass:"value"},[a("el-input",{attrs:{size:"small",type:"text"},model:{value:t.pointDialog.faultNo,callback:function(e){t.$set(t.pointDialog,"faultNo",e)},expression:"pointDialog.faultNo"}})],1)]),a("div",{staticClass:"r-table-item"},[a("div",{staticClass:"name"},[t._v(" 点类型 ")]),a("div",{staticClass:"value"},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:t.pointDialog.pointType,callback:function(e){t.$set(t.pointDialog,"pointType",e)},expression:"pointDialog.pointType"}},[a("el-option",{attrs:{label:"波形图采集",value:"chart"}}),a("el-option",{attrs:{label:"电压采集",value:"v"}}),a("el-option",{attrs:{label:"状态管理",value:"status"}})],1)],1)])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{float:"left"},attrs:{type:"danger",size:"small"},on:{click:t.deletePoint}},[t._v("删除此点")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.pointDialog.open=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.savePoint}},[t._v("确认编辑")])],1)]):t._e(),t.vInfo.length>0?a("div",{staticClass:"point-footer-bar"},[a("div",{staticClass:"point-footer-flex"},t._l(t.vInfo,(function(e){return a("div",{key:"v-"+e.id,staticClass:"vDialog"},[a("div",{staticClass:"title"},[t._v(" 电压表 "),a("div",{staticClass:"refresh",on:{click:function(a){return t.getV(e)}}},[t._v(" 刷新 ")]),a("div",{staticClass:"close",on:{click:function(a){return t.closeVPanel(e)}}},[t._v(" 关闭 ")])]),a("div",{staticClass:"content"},[null!==e.data.v&&void 0!==e.data.v?a("div",[a("div",{staticClass:"v"},[t._v(" "+t._s(e.data.v)),a("span",[t._v("v")])]),a("div",{staticClass:"info"},[t._v(" "+t._s(e.data.name)+" ")])]):t._e(),null===e.data.v||void 0===e.data.v?a("div",[a("div",{staticClass:"v"},[t._v(" - - ")]),a("div",{staticClass:"info"},[t._v(" "+t._s(e.data.name)+" ")])]):t._e(),"error"===e.data.v?a("div",[a("div",{staticClass:"v"},[t._v(" 错误 ")]),a("div",{staticClass:"info"},[t._v(" "+t._s(e.data.name)+" ")])]):t._e()])])})),0)]):t._e()],1)},o=[],s=a("b85c"),n=(a("a434"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("b0c0"),a("c35a"),a("a9e3"),a("b680"),a("ac1f"),a("841c"),a("25eb"),a("4057"),a("6bd7")),l=a("526f"),r=a("e26d"),c=Object(n["a"])()?"DOMMouseScroll":"mousewheel",u={name:"Point",data:function(){return{vInfo:[],backgroundImage:"",touch:{status:"",isZoom:!1},pointMode:"guest",pointDialog:{pointInfo:null,pointId:null,open:!1,cardNo:"",faultNo:"",name:"",pointType:null},message:"",points:[],pointFade:!1,activePointId:null,activePoint:{},pointMove:{lock:!1,oldX:null,oldY:null},viewArea:{zoom:1,top:0,left:0,oldTop:0,oldLeft:0,moveObject:"div",mouseActive:!1,mouseMove:{x:null,y:null},mouseStart:{x:null,y:null},mouseStart2:{x:null,y:null},mouseEnd:{x:null,y:null}}}},beforeRouteEnter:function(t,e,a){a((function(t){t.readData()}))},beforeRouteLeave:function(t,e,a){this.uninstall(),a()},mounted:function(){this.install(),this.readData(),window.initdata=this.initPointData,window.onMqttMessage=this.pullAMessage},methods:{toListMode:function(){this.$router.push({name:"PointList"})},updateStudentData:function(){var t,e=this.$copyObject(this.vInfo),a=Object(s["a"])(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;i.ref="teacher"}}catch(o){a.e(o)}finally{a.f()}Object(r["c"])("studentVInfo",JSON.stringify({code:0,data:e}))},pullAMessage:function(t,e){var a=JSON.parse(e);if("voltage"===a.mess){console.log(a),console.log(this.vInfo);var i,o=Object(s["a"])(this.vInfo);try{for(o.s();!(i=o.n()).done;){var n=i.value;console.log(n.data.cardNo+""===a.card+""),console.log(n.data.faultNo+""===a.address+""),n.data.cardNo+""===a.card+""&&n.data.faultNo+""===a.address+""&&(n.data["v"]=a.v0)}}catch(l){o.e(l)}finally{o.f()}this.$forceUpdate(),this.updateStudentData()}},closeVPanel:function(t){for(var e=0;e<this.vInfo.length;e++){var a=this.vInfo[e];a===t&&this.vInfo.splice(e,1)}this.updateStudentData()},getV:function(t){Object(r["c"])("v"+Object(r["a"])(),JSON.stringify({command:"voltage",card:t.data.cardNo,address:t.data.faultNo}))},initPointData:function(t){console.log(t),null===t||""===t?this.$message.error("点位数据不能为空，请重试！"):(this.points=JSON.parse(t),this.saveData())},resetArea:function(){this.viewArea.top=0,this.viewArea.left=0,this.viewArea.zoom=1},clearPoint:function(){this.points=[],this.saveData()},selectImage:function(){this.uploadImage()},uploadImage:function(){var t=this,e=document.createElement("input");e.setAttribute("id","file"),e.setAttribute("type","file"),e.setAttribute("name","file"),e.setAttribute("style","visibility:hidden"),document.body.appendChild(e),e.value,e.click(),e.onchange=function(){console.log(e.files);var a=new FileReader;a.readAsDataURL(e.files[0]),a.onload=function(){console.log(a.result),t.backgroundImage=a.result,t.resetArea()}}},downloadPoint:function(){this.downloadFile(JSON.stringify(this.points),"points.txt")},downloadFile:function(t,e){var a=document.createElement("a");a.download=e,a.style.display="none";var i=new Blob([t]);a.href=URL.createObjectURL(i),document.body.appendChild(a),a.click(),document.body.removeChild(a)},readData:function(){var t=JSON.parse(localStorage.getItem("point_data_share"));t=null===t||void 0===t?[]:t,this.points=t},saveData:function(){localStorage.setItem("point_data_share",JSON.stringify(this.points)),window.bound.savedata(JSON.stringify(this.points))},touchStart:function(t){console.log(t),this.touch.status=!0},touchEnd:function(t){console.log(t),this.touch.status=!1},touchMove:function(t){console.log(t)},deletePoint:function(){for(var t=0;t<this.points.length;t++){var e=this.points[t];e.id===this.pointDialog.pointId&&this.points.splice(t,1)}this.pointDialog.open=!1,this.$message.success("已删除此点")},savePoint:function(){var t,e=Object(s["a"])(this.points);try{for(e.s();!(t=e.n()).done;){var a=t.value;a.id===this.pointDialog.pointId&&(a.data.cardNo=this.pointDialog.cardNo,a.data.faultNo=this.pointDialog.faultNo,a.data.pointType=this.pointDialog.pointType,a.data.name=this.pointDialog.name)}}catch(i){e.e(i)}finally{e.f()}this.$message.success("故障点信息编辑成功"),this.pointDialog.open=!1},pointClick:function(t){if(this.pointMove.lock)return!1;t.id;if("guest"===this.pointMode&&"status"===t.data.pointType)return 0===t.data.pointStatus?t.data.pointStatus=2:1===t.data.pointStatus?t.data.pointStatus=0:2===t.data.pointStatus?t.data.pointStatus=1:t.data.pointStatus=0,Object(r["c"])("v"+Object(r["a"])(),JSON.stringify({command:"fault",card:t.data.cardNo,address:t.data.faultNo,status:t.data.pointStatus})),this.saveData(),!1;if("guest"===this.pointMode&&"v"===t.data.pointType){var e,a=!1,i=Object(s["a"])(this.vInfo);try{for(i.s();!(e=i.n()).done;){var o=e.value;o.data.cardNo===t.data.cardNo&&o.data.faultNo===t.data.faultNo&&(this.getV(t),a=!0)}}catch(n){i.e(n)}finally{i.f()}a||(this.vInfo.push(t),this.getV(t))}},uninstall:function(){Object(l["a"])(document,"touchmove"),Object(l["a"])(document,"keydown",this._keyDownHandler),Object(l["a"])(document,c,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},install:function(){var t=this;this._mouseWheelHandler=Object(n["b"])((function(e){var a=e.wheelDelta?e.wheelDelta:-e.detail;a>0?(t.viewArea.zoom+=.1,t.viewArea.zoom=Number.parseFloat(t.viewArea.zoom.toFixed(2))):(t.viewArea.zoom-=.1,t.viewArea.zoom<=.1&&(t.viewArea.zoom=.1),t.viewArea.zoom=Number.parseFloat(t.viewArea.zoom.toFixed(2)))})),Object(l["b"])(document,"touchmove",(function(e){t.moseMove("touch",e)})),Object(l["b"])(document,"touchend",(function(e){t.mouseUp("touch",e)})),Object(l["b"])(document,"mousemove",(function(e){t.moseMove("mouse",e)})),Object(l["b"])(document,"mouseup",(function(e){t.mouseUp("mouse",e)})),Object(l["b"])(document,"keydown",this._keyDownHandler),Object(l["b"])(document,c,this._mouseWheelHandler)},imageAreaClick:function(t){if("guest"===this.pointMode)return!1;if(1!==this.viewArea.zoom)return this.viewArea.zoom=1,this.$message.success("已进入新增点模式，请双击画布新增点！"),!1;var e=this.$refs.pointViewArea.clientWidth,a=t.pageX,i=t.layerX,o=t.layerY;console.log("width: ",e),console.log("left: ",this.viewArea.left,"pageX: ",a,"layerX: ",i,"mouseX: ",this.viewArea.mouseEnd.x),console.log("图片宽度：",this.$refs.mainImage.width),console.log("图片高度：",this.$refs.mainImage.height);var s=this.$refs.mainImage.width,n=this.$refs.mainImage.height,l=s/2-document.body.clientWidth/2,r=i+this.viewArea.left+(l-this.viewArea.left)+(document.body.clientWidth-e)/2-10,c=o+this.viewArea.top+((n-400)/2-this.viewArea.top)-20,u={id:this.points.length+1,x:r,y:c,theme:"",zoom:1,data:{pointType:"status",pointStatus:0,cardNo:"",faultNo:"",name:""}};this.points.push(u),console.log("计算结果：",r)},mouseDown:function(t,e){var a=0;if(a=-1!==e.path[0].className.search("point-status-text")?2:-1!==e.path[0].className.search("point-status")?1:0,"touch"===t?(this.viewArea.mouseStart={x:e.touches[0].pageX,y:e.touches[0].pageY},e.touches[1]&&(this.viewArea.mouseStart2={x:e.touches[1].pageX,y:e.touches[1].pageY})):"mouse"===t&&(this.viewArea.mouseStart={x:e.pageX,y:e.pageY}),"touch"===t&&e.touches.length>=2)return!1;if(-1===e.path[a].className.search("point"))this.viewArea.moveObject="div",this.viewArea.mouseActive=!0,this.pointFade=!1;else{this.viewArea.mouseActive=!0,this.activePointId=e.path[a].attributes["data-point"].nodeValue;var i,o=Object(s["a"])(this.points);try{for(o.s();!(i=o.n()).done;){var n=i.value;n.id===Number.parseInt(this.activePointId)&&(this.activePoint=n)}}catch(l){o.e(l)}finally{o.f()}console.log(this.activePoint),this.pointMove.oldX=JSON.parse(JSON.stringify(this.activePoint.x)),this.pointMove.oldY=JSON.parse(JSON.stringify(this.activePoint.y)),this.viewArea.moveObject="point"}this.viewArea.oldLeft=JSON.parse(JSON.stringify(this.viewArea.left)),this.viewArea.oldTop=JSON.parse(JSON.stringify(this.viewArea.top))},mouseUp:function(t,e){var a=this;this.viewArea.mouseActive=!1,setTimeout((function(){a.pointMove.lock=!1}),100),this.pointFade=!0,"touch"===t?this.viewArea.mouseEnd={x:e.touches[0].pageX,y:e.touches[0].pageY}:"mouse"===t&&(this.viewArea.mouseEnd={x:e.pageX,y:e.pageY})},getDistance:function(t,e){return Math.hypot(e.x-t.x,e.y-t.y)},moseMove:function(t,e){if("touch"===t?this.viewArea.mouseMove={x:e.touches[0].pageX,y:e.touches[0].pageY}:"mouse"===t&&(this.viewArea.mouseMove={x:e.pageX,y:e.pageY}),"touch"===t&&e.touches.length>=2){var a=e.touches[0],i=e.touches[1],o=this.getDistance({x:a.pageX,y:a.pageY},{x:i.pageX,y:i.pageY})/this.getDistance({x:this.viewArea.mouseStart.x,y:this.viewArea.mouseStart.y},{x:this.viewArea.mouseStart2.x,y:this.viewArea.mouseStart2.y});this.touch.status=o,console.log("zoom",o),o>1?(this.viewArea.zoom+=.01,this.viewArea.zoom=Number.parseFloat(this.viewArea.zoom.toFixed(2))):(this.viewArea.zoom-=.01,this.viewArea.zoom<=.1&&(this.viewArea.zoom=.1),this.viewArea.zoom=Number.parseFloat(this.viewArea.zoom.toFixed(2)))}if(this.viewArea.mouseActive)if("div"===this.viewArea.moveObject||"guest"===this.pointMode){var s=3;this.viewArea.left=this.viewArea.mouseMove.x*s-this.viewArea.mouseStart.x*s+this.viewArea.oldLeft,this.viewArea.top=this.viewArea.mouseMove.y*s-this.viewArea.mouseStart.y*s+this.viewArea.oldTop}else if("point"===this.viewArea.moveObject){this.pointMove.lock=!0;var n=1/this.viewArea.zoom;this.activePoint.x=this.viewArea.mouseMove.x*n-this.viewArea.mouseStart.x*n+this.pointMove.oldX,this.activePoint.y=this.viewArea.mouseMove.y*n-this.viewArea.mouseStart.y*n+this.pointMove.oldY}}}},d=u,v=(a("7e33"),a("2877")),p=Object(v["a"])(d,i,o,!1,null,null,null);e["default"]=p.exports}}]);